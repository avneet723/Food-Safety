01f7321ac0c3b1a5b1d096c48f821db7
jsio("import net.interfaces");jsio("from net.csp.client import CometSession");jsio("import std.utf8 as utf8");exports.Connector=__class__;
exports.Connector=exports.Connector(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Connector,function(){this.connect=function(){this._state=net.interfaces.STATE.CONNECTING;var a=new CometSession;a.onconnect=bind(this,"cometSessionOnConnect",a);a.ondisconnect=bind(this,"onDisconnect");logger.debug("opening the connection");this._opts.encoding||(this._opts.encoding="plain");a.connect(this._opts.url,this._opts)};this.cometSessionOnConnect=function(a){logger.debug("conn has opened");
this.onConnect(new Transport(a))}});var Transport=__class__,Transport=Transport(function(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Transport,function(){this.init=function(a){this._conn=a};this.makeConnection=function(a){this._conn.onread=bind(a,"dataReceived")};this.write=function(a){this._conn.write(a)};this.loseConnection=function(){this._conn.close()}});
