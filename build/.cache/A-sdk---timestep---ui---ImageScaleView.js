59ec4d71d404149aa8e210dc5fa0e491
jsio("import ui.View");jsio("import ui.resource.Image as Image");var sdk_timestep_ui_ImageScaleView=__class__;
exports=sdk_timestep_ui_ImageScaleView(function(){return this.init&&this.init.apply(this,arguments)},ui.View,function(t){var v={image:null,autoSize:!1,scaleMethod:"stretch",renderCenter:!0,clip:!0};this.init=function(a){a=merge(a,v);t(this,"init",[a])};this.updateOpts=function(a){a=t(this,"updateOpts",arguments);a.scaleMethod&&(this._scaleMethod=a.scaleMethod,this._isSlice="slice"==this._scaleMethod.slice(1));this.debug=!!a.debug;this._sourceSlices=a.sourceSlices;this._destSlices=a.destSlices||a.sourceSlices;
this._imgScale=a.imgScale||1;if(this._isSlice){if("2slice"===a.scaleMethod&&(a.sourceSlices.horizontal&&a.destSlices.horizontal&&(a.destSlices.horizontal.left?(a.sourceSlices.horizontal.center=a.sourceSlices.horizontal.right,a.sourceSlices.horizontal.right=0):a.destSlices.horizontal.right&&(a.sourceSlices.horizontal.center=a.sourceSlices.horizontal.left,a.sourceSlices.horizontal.left=0)),a.sourceSlices.vertical&&a.destSlices.vertical))a.destSlices.vertical.top?(a.sourceSlices.vertical.middle=a.sourceSlices.vertical.bottom,
a.sourceSlices.vertical.bottom=0):a.destSlices.vertical.bottom&&(a.sourceSlices.vertical.middle=a.sourceSlices.vertical.bottom,a.sourceSlices.vertical.bottom=0);if(!a.sourceSlices||!a.sourceSlices.horizontal&&!a.sourceSlices.vertical)throw Error("slice views require sourceSlices.horizontal and/or sourceSlices.vertical");if(a.sourceSlices.horizontal){var d=a.width?a.width-a.sourceSlices.horizontal.left-a.sourceSlices.horizontal.right:0;this._sourceSlicesHor=[a.sourceSlices.horizontal.left,a.sourceSlices.horizontal.center||
d,a.sourceSlices.horizontal.right];this._destSlicesHor=[(this._destSlices.horizontal.left||0)*this._imgScale,0,(this._destSlices.horizontal.right||0)*this._imgScale]}else this._sourceSlicesHor=[0,100,0],this._destSlicesHor=[0,100,0];a.sourceSlices.vertical?(d=a.height?a.height-a.sourceSlices.vertical.top-a.sourceSlices.vertical.bottom:0,this._sourceSlicesVer=[a.sourceSlices.vertical.top,a.sourceSlices.vertical.middle||d,a.sourceSlices.vertical.bottom],this._destSlicesVer=[(this._destSlices.vertical.top||
0)*this._imgScale,0,(this._destSlices.vertical.bottom||0)*this._imgScale]):(this._sourceSlicesVer=[0,100,0],this._destSlicesVer=[0,100,0])}a.image&&this.setImage(a.image,a);a.verticalAlign&&(this._verticalAlign=a.verticalAlign);a.align&&(this._align=a.align);this.rows=a.rows;this.columns=a.columns;return a};this.getImage=function(){return this._img};this.setImage=function(a,d){var i=!1,g,b,h,c,d=merge(d,this._opts);if("string"==typeof a){if(c=GCResources.getMap()[a])b=c.w,h=c.h}else a instanceof Image&&
a.isLoaded()&&(c=a.getBounds(),b=c.width,h=c.height);if(!c)return"string"==typeof a&&(a=new Image({url:a})),a.doOnLoad(this,"setImage",a,d);if(d.autoSize&&"stretch"==this._scaleMethod&&(!d.width&&!d.layoutWidth||!d.height&&!d.layoutHeight))i=!0,this.style.fixedAspectRatio&&(this.style.updateAspectRatio(b,h),c=this.getSuperview(),d.width?(b=d.width,h=d.width/this.style.aspectRatio):d.height?(h=d.height,b=d.height*this.style.aspectRatio):d.layoutWidth&&c.style.width?(b=c.style.width*parseFloat(d.layoutWidth)/
100,h=b/this.style.aspectRatio):d.layoutHeight&&c.style.height&&(h=c.style.height*parseFloat(d.layoutHeight)/100,b=h*this.style.aspectRatio)),this.style.width=b,this.style.height=h;if(this._isSlice){var e=this._sourceSlicesHor;c=this._sourceSlicesVer;e&&(g=e[0]+e[1]+e[2],b/=g,e[0]*=b,e[1]*=b,e[2]*=b);c&&(b=c[0]+c[1]+c[2],b=h/b,c[0]*=b,c[1]*=b,c[2]*=b)}if(this._img="string"==typeof a?new Image({url:a}):a)d&&(d.autoSize&&!i)&&this._img.doOnLoad(this,"autoSize"),this._img.doOnLoad(this,"needsRepaint")};
this.doOnLoad=function(){1==arguments.length?this._img.doOnLoad(this,arguments[0]):this._img.doOnLoad.apply(this._img,arguments);return this};this.autoSize=function(){this._img&&(this.style.width=this._opts.width||this._img.getWidth(),this.style.height=this._opts.height||this._img.getHeight())};this.getOrigWidth=this.getOrigW=function(){return this._img.getOrigW()};this.getOrigHeight=this.getOrigH=function(){return this._img.getOrigH()};this.renderSlice=function(a){var d=["#FF0000","#00FF00","#0000FF"],
i=this.getPosition().scale,g=this._img.getBounds(),b=g.width,h=g.height,c=this._img.getSource(),e=this._sourceSlicesHor,l=this._sourceSlicesVer,f=[],j=[],m=g.x,u=g.y,r=b,o=h,q=this.style,o=q.width,m=q.height,k=0,q=0,p=o,n=m,s;if(!(0>=b||0>=h)){e&&(k=this.style.fixedAspectRatio?m/h:1,f[0]=this._destSlicesHor[0]*k,f[2]=this._destSlicesHor[2]*k,f[1]=o-f[0]-f[2],0>f[1]&&(p=f[0]+f[2],f[0]=f[0]*o/p|0,f[1]=0,f[2]=o-f[0]));l&&(k=this.style.fixedAspectRatio?o/b:1,j[0]=this._destSlicesVer[0]*k,j[2]=this._destSlicesVer[2]*
k,j[1]=m-j[0]-j[2],0>j[1]&&(n=j[0]+j[2],j[0]=j[0]*m/n|0,j[1]=0,j[2]=m-j[0]));for(b=h=0;3>b;b++){var t=0,n=j[b]+h,k=Math.round(i*n)/i,h=n-k,o=l[b],n=k,m=g.x;for(s=k=0;3>s;s++)r=f[s]+t,p=Math.round(i*r)/i,t=r-p,r=e[s],0<p&&0<n&&(a.drawImage(c,m,u,r,o,k,q,p,n),this.debug&&(a.strokeStyle=d[(b+s)%3],a.strokeRect(k+0.5,q+0.5,p-1,n-1))),m+=r,k+=p;u+=o;q+=n}}};this.render=function(a){if(this._img){var d=this.style,i=d.width,d=d.height,g=this._img.getBounds(),b=g.width,g=g.height,h=["#FF0000","#00FF00","#0000FF"];
switch(this._scaleMethod){case "none":this._img.render(a,0,0);break;case "stretch":this._img.render(a,0,0,i,d);break;case "contain":case "cover":var c=1,c=b/g,e=i/d,c=("cover"==this._scaleMethod?e>c:e<c)?i/b:d/g,b=b*c,g=g*c,c="left"==this._align?0:"right"==this._align?i-b:(i-b)/2,e="top"==this._verticalAlign?0:"bottom"==this._verticalAlign?d-g:(d-g)/2;this._img.render(a,c,e,b,g);break;case "tile":e=c=0;if(this.rows)for(var l=d/this.rows,f=b*(l/g),b=0;b<this.rows;b++){for(;c<i;)this._img.render(a,
c,e,f,l),this.debug&&(a.strokeStyle=h[b%3],a.strokeRect(c+0.5,e+0.5,f-1,l-1)),c+=f;e+=l}else if(this.columns){f=i/this.columns;l=g*(f/b);for(b=0;b<this.columns;b++){for(;e<d;)this._img.render(a,c,e,f,l),this.debug&&(a.strokeStyle=h[b%3],a.strokeRect(c+0.5,e+0.5,f-1,l-1)),e+=l;c+=f}}break;case "2slice":case "3slice":case "6slice":case "9slice":this.renderSlice(a)}}};this.getTag=function(){return"ImageScaleView"+this.uid+":"+(this._img&&this._img._map.url.substring(0,16))}});
