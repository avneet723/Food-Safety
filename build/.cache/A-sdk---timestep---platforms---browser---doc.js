70aefad1d8441b85d67ffd663cf9ca6d
jsio("import lib.PubSub");jsio("import lib.Enum as Enum");jsio("import std.js as JS");jsio("from util.browser import $");jsio("import device");
var SCALING=Enum("FIXED","RESIZE","MANUAL"),defaultScalingMode=device.isMobileBrowser||device.simulating?SCALING.RESIZE:SCALING.FIXED,Document=__class__,Document=Document(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(){if($){var a=GLOBAL.document;this._el=$({parent:a&&a.body,style:{position:"absolute",overflow:"hidden",width:"100%",height:"100%"}});device.screen.subscribe("Resize",this,"onResize");exports.postCreateHook&&exports.postCreateHook(this);
this.setScalingMode(defaultScalingMode)}};this.unsubscribeResize=function(){device.screen.unsubscribe("Resize",this,"onResize")};this.setEngine=function(a){a!=this._engine&&(this._engine=a,this._canvas=this._engine.getCanvas(),this.appendChild(this._canvas),this._canvas.getContext&&(a=this._canvas.getContext(window.WebGLRenderingContext?"webgl":"2d"),a.setParentNode&&a.setParentNode(this._el)))};this.getElement=function(){return this._el};this.setScalingMode=function(a,b){this._scalingMode=a;var c=
this._el.style;switch(a){case SCALING.FIXED:b=merge(b,{width:device.width,height:device.height});c.width=b.width+"px";c.height=b.height+"px";break;case SCALING.RESIZE:b=merge(b,{resizeCanvas:!0});case SCALING.MANUAL:c.margin="0px",c.width="100%",c.height="100%"}this._scalingOpts=b;this.onResize();setTimeout(bind(this,"onResize"),1E3)};this.onResize=function(){var a=this._el,b=this._el.style;a.className=device.screen.orientation;logger.log("resize",device.width,device.height);var c=device.width,d=
device.height,f=this._scalingMode,e=this._scalingOpts;f==SCALING.FIXED&&(c=e.width,d=e.height);e.maxWidth&&c>e.maxWidth&&(c=e.maxWidth,f==SCALING.RESIZE&&(f=SCALING.FIXED));e.maxHeight&&d>e.maxHeight&&(d=e.maxHeight,f==SCALING.RESIZE&&(f=SCALING.FIXED));switch(f){case SCALING.FIXED:a.style.top=Math.round(Math.max(0,(window.innerHeight-d)/2))+"px";a.style.left=Math.round(Math.max(0,(window.innerWidth-c)/2))+"px";b.width=c+"px";b.height=d+"px";break;case SCALING.RESIZE:if(e.resizeCanvas&&this._canvas&&
(this._canvas.width!=c||this._canvas.height!=d))this._canvas.width=c,this._canvas.height=d;b.width=c+"px";b.height=d+"px"}this._setDim(c,d);this._engine&&this._engine.render()};this._setDim=function(a,b){if(this.width!=a||this.height!=b)this.width=a,this.height=b,this.publish("Resize",a,b)};this.setColors=function(a,b){this._el&&(this._el.style.background=b,document.documentElement.style.background=document.body.style.background=a)};this.appendChild=function(a){this._el.appendChild(a)};this.getOffset=
function(){return{x:this._el.offsetLeft,y:this._el.offsetTop}}});exports=new Document;exports.SCALING=SCALING;exports.setDocStyle=function(){var a=GLOBAL.document;a&&a.body&&(a={height:"100%",margin:"0px",padding:"0px"},$.style(document.documentElement,a),$.style(document.body,a))};exports.defaultParent=null;exports.postCreateHook=null;
