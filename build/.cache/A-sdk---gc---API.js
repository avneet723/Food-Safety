1b2c809ae385b8e55b17bda86957ad8e
jsio("import lib.PubSub");jsio("import lib.Callback");jsio("import std.uri as URI");jsio("import ui.Engine");jsio("import ui.View");jsio("import ui.StackView");jsio("import device");device.simulatingMobileNative&&jsio("import .debugging.nativeShim");GLOBAL.CONFIG||(GLOBAL.CONFIG={});GLOBAL.DEBUG||(GLOBAL.DEBUG=!1);GLOBAL.CONFIG.isMuted&&(jsio("import AudioManager"),GLOBAL.ACCESSIBILITY.mute(!0));var sdk_gc_API=__class__;
exports=sdk_gc_API(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){var c=navigator.userAgent;if(this.isNative=/TeaLeaf/.test(c)){this.isIOS=/iPhone OS/.test(c);this.isAndroid=/Android/.test(c)}else if(/(iPod|iPhone|iPad)/i.test(c)){this.isIOS=this.isMobileBrowser=true;this.isUIWebView=!/Safari/.test(c)}else if(/Android/.test(c))this.isAndroid=this.isMobileBrowser=true;else{this.isDesktop=true;this.isFacebook=GLOBAL.CONFIG.isFacebookApp}this.init=function(){if(DEBUG&&
GLOBAL.window&&window.top)try{window.top.GC=GLOBAL.GC}catch(b){}if(GLOBAL.ADDON_SOCIAL&&ADDON_SOCIAL){jsio("import GCSocial.GCSocial",{suppressErrors:true});this.social=GCSocial.GCSocial;GLOBAL.gcsocial=this.social;this.social.init({appID:GLOBAL.CONFIG.appID,shortName:GLOBAL.CONFIG.shortName,inviteURLTemplate:GLOBAL.CONFIG.inviteURLTemplate,endpoint:GLOBAL.CONFIG.servicesURL});this.track=gcsocial.tracker}window.addEventListener("pageshow",bind(this,"_onShow"),false);window.addEventListener("pagehide",
bind(this,"_onHide"),false);this.isOnline=navigator.onLine;window.addEventListener("online",bind(this,function(){if(!this.isOnline){this.isOnline=true;this.publish("OnlineStateChanged",true)}}),false);window.addEventListener("offline",bind(this,function(){if(this.isOnline){this.isOnline=false;this.publish("OnlineStateChanged",false)}}),false);CONFIG.version&&logger.log("Version",CONFIG.version)};GLOBAL.GC=new this.constructor;GC.Application=ui.StackView;jsio("import .UI");GC.ui=new UI;var d;try{GLOBAL.CACHE&&
(d=JSON.parse(GLOBAL.CACHE["spritesheets/map.json"]))}catch(i){logger.warn("spritesheet map failed to parse",i)}jsio("import ui.resource.loader");GC.resources=ui.resource.loader;GC.resources.setMap(d);GC.env=="browser"&&setTimeout(bind(this,"_onShow"),0);this._onHide=function(){this.app&&this.app.onPause&&this.app.onPause();this.publish("Hide");this.publish("AfterHide");this.tracker&&this.tracker.endSession()};this._onShow=function(){this.app&&this.app.onResume&&this.app.onResume();this.publish("Show");
this.publish("AfterShow")};this.buildApp=function(){jsio("import src.Application as Application");Application.prototype.__root=true;this.app=new Application;this.buildEngine(merge({view:this.app},this.app._settings));return this.app};this.buildEngine=function(b){b||(b={});if(!b.entry)b.entry="launchUI";var a=b.view;if(!a)throw"a timestep.Engine must be created with a root view";if(!(a instanceof ui.View))throw"src/Application.js must export a Class that inherits from ui.View";a.subscribe("onLoadError",
this,"_onAppLoadError");var c;typeof a[b.entry]=="function"&&(c=bind(a,b.entry));a.view=a;a.engine=new ui.Engine(b);a.engine.show();a.engine.startLoop();try{a.initUI&&a.initUI();var e=(a._settings||{}).preload,d=CONFIG.splash&&CONFIG.splash.autoHide!==false;if(e&&e.length){for(var f=new lib.Callback,b=0,g;g=e[b];++b)GC.resources.preload(g,f.chain());d&&f.run(GC,"hidePreloader",null);c&&f.run(c)}else{d&&GC.hidePreloader();c&&c()}}catch(h){this._onAppLoadError(h);throw h;}};this._onAppLoadError=function(b){logger.error("encountered error when creating src Application: ",
JSON.stringify(b));var a=CONFIG.splash;if(a&&a.onAppLoadError)a.onAppLoadError(b)};this.hidePreloader=function(b){var a=CONFIG.splash;if(a&&a.hide&&!a.hidden){a.hide(b);a.hidden=true}else b&&b()}});
