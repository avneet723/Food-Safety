35a439c2a313e17992d7ca95a7db2312
var _debug,DEBUG=!1,MAX_REFLOW_THRESHOLD=6,_pool=new (Class(function(){this._pool=[];this.recycle=function(b){b.count=0;b.view=null;this._pool.push(b)};this.get=function(b){var c=this._pool.pop()||{};c.view=b;c.iter=0;c.count=0;return c}})),sdk_timestep_ui_backend_ReflowManager=__class__,ReflowManager=exports=sdk_timestep_ui_backend_ReflowManager(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._pending={};this._iter=0};this.setInRender=function(b){this._isInRender=
b};this.add=function(b){var c=b.uid,a=this._pending[c]||(this._pending[c]=_pool.get(b));a.needsReflow=!0;a.iter!=this._iter&&(a.count++,a.iter=this._iter);DEBUG&&_debug.log("adding view",c,b.style.width+"x"+b.style.height,b.getTag());this._isInRender&&!this._isInReflow&&this.startReflow(this._lastCtx)};this._reflow=function(b,c){c.needsReflow=!1;var a=c.view,d=a.style;d.__firstRender||(d.__firstRender=!0,DEBUG&&_debug.log("calling buildView for",a.uid,"("+a.style.width+"x"+a.style.height+")")&&_debug.stepIn(),
a.buildView(b),DEBUG&&_debug.stepOut());if(a.hasListeners("Resize")){var e=d.width,f=d.height;if(d.__cachedWidth!=e||d.__cachedHeight!=f)d.__cachedWidth=e,d.__cachedHeight=f,a.publish("Resize")}a.__layout&&a.__layout.reflow();a.reflow(!1)};this.startReflow=function(b){this._lastCtx=b;this._isInReflow=!0;this._iter=0;var c;DEBUG&&_debug.stepIn();do{++this._iter;c=0;for(var a in this._pending){var d=this._pending[a];if(d.count>MAX_REFLOW_THRESHOLD){logger.warn("reflow loop detected for view",d.view.uid);
break}d.needsReflow&&(DEBUG&&_debug.log("starting reflow for view",d.view.uid,"("+d.count+" times)")&&_debug.stepIn(),this._reflow(b,d),DEBUG&&_debug.stepOut(),++c)}DEBUG&&c&&_debug.log("iteration",this._iter,"reflowed",c,"views")}while(c);for(a in this._pending)_pool.recycle(this._pending[a]);this._pending={};this._isInReflow=!1;DEBUG&&_debug.stepOut()}}),_instance=null;exports.get=function(){return _instance||(_instance=new ReflowManager)};
