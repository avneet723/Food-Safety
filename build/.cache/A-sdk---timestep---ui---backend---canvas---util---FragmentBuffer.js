208e84fd3b3731481f4cc178322225fc
jsio("import device");jsio("import .FragmentBin");jsio("import .SortedLinkedList as SortedList");
var sdk_timestep_ui_backend_canvas_util_FragmentBuffer=__class__,FragmentBuffer=exports=sdk_timestep_ui_backend_canvas_util_FragmentBuffer(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(a){this.opts=merge(a,{})};var c=function(a,b){return a.size()>b.size()};this._build=function(){this._canvas=new (device.get("Canvas"))({width:1024,height:1024});this._ctx=this.getCanvas().getContext("2d");this._ctx.clearRect(0,0,1024,1024);this._ctx.textAlign="left";this._ctx.textBaseline=
"middle";this._ctx.globalCompositeOperation="source-over";this._cache={};this._binList=new SortedList(c);this._binList.insert(new FragmentBin({x:0,y:0,width:1024,height:1024}))};this.getCanvas=function(){this._canvas||this._build();return this._canvas};this.getContext=function(){this._ctx||this._build();return this._ctx};this.onGetHash=function(){throw Error("onGetHash should be implemented.");};this._insertText=function(a){for(var b=a.width,c=a.height,d=this._binList.iterator(),a=null,e=!1;d.hasNext()&&
!e;)a=d.next(),!a.filled&&a.width>=b&&a.height>=c?e=!0:a=null;if(a){newBins=a.split(b,c);for(b=0;b<newBins.length;b++)this._binList.insert(newBins[b])}else logger.log("buffer full, further TextViews will not be cached");return a};this.getPositionForText=function(a){var b=this.onGetHash(a);!this._cache[b]&&0<a.width&&(this._cache[b]=this._insertText(a));return this._cache[b]};this.clearBuffer=function(){this._cache={};this._binList=new SortedList(c);this._binList.insert(new FragmentBin({x:0,y:0,width:1024,
height:1024}))}});
