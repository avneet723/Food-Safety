db44a9a96b9a49054604af2e2a06b1b6
jsio("import ui.layout.Padding as Padding");jsio("import .BoxLayout");var DEBUG=!1,sdk_timestep_ui_layout_LinearLayout=__class__;
exports=sdk_timestep_ui_layout_LinearLayout(function(){return this.init&&this.init.apply(this,arguments)},BoxLayout,function(s){function t(){return this.view.style._sortOrder+this.index}this.reflowsChildren=!0;this.init=function(a){this._view=a.view;this._view.subscribe("SubviewAdded",this,"_onSubviewAdded");this._view.subscribe("SubviewRemoved",this,"_onSubviewRemoved");this.setDirection(a.isVertical?"vertical":"horizontal");this._views=[];for(var a=this._view.getSubviews(),b=0,c;c=a[b];++b)c.style.inLayout&&
this._views.push(this._initLayoutView(c));this._forwardEvents();this._debug=DEBUG};this._onSubviewRemoved=function(a){a.style.inLayout&&this.remove(a)};this._onSubviewAdded=function(a){a.style.inLayout&&this.add(a)};this.debug=function(){this._debug=!0;return this};this.setDirection=function(a){this._direction=a;this._propPos=(a="vertical"==a)?"y":"x";this._propPosOpp=a?"x":"y";this._propDim=a?"height":"width";this._minPropDim=a?"minHeight":"minWidth";this._maxPropDim=a?"maxHeight":"maxWidth";this._propDimOpp=
a?"width":"height";this._propSideA=a?"top":"left";this._propSideB=a?"bottom":"right";this._flexProp=a?"vflex":"hflex";this._view.needsReflow();return this};this.getDirection=function(){return this._direction};this._events=["ViewWillAppear","ViewDidAppear","ViewWillDisappear","ViewDidDisappear"];this._forwardEvents=function(){for(var a=0,b;b=this._events[a];++a)this._view.subscribe(b,this,"_forwardSignal",b)};this._events=["ViewWillAppear","ViewDidAppear","ViewWillDisappear","ViewDidDisappear"];this._forwardSignal=
function(){for(var a=0,b;b=this._views[a];++a)b.view.publish.apply(b.view,arguments)};this._initLayoutView=function(a){a.style.inLayout=!0;this._debug&&logger.log(this._view.uid,"adding view",a.uid,this._propDim,a.style[this._propDim]);this._view.connectEvent(a,"Resize",bind(this,"reflow"));return{view:a,index:0,toString:t}};this.getSize=function(){return this._size};this.getViewIndex=function(a){for(var b=0,c;c=this._views[b];++b)if(c.view==a)return b;return-1};this.addSubviews=function(a){this._debug&&
logger.log(this._view.uid,"adding",a.length,"views");if(isArray(a)){for(var b=0,c=a.length;b<c;++b){var g=a[b];g&&this._views.push(this._initLayoutView(g))}this._view.needsReflow()}else this.insertBefore(a);return this};this.getSubviews=function(){return this._views.map(function(a){return a.view})};this.remove=function(a){var b=this.getViewIndex(a);-1!=b&&(this._views.splice(b,1),this._view.disconnectEvent(a,"Resize"),this._view.needsReflow())};this.add=this.insertBefore=function(a,b){if(-1==this.getViewIndex(a)){var c=
this._initLayoutView(a),g=!1;if(b){var f=this.getViewIndex(b);-1!=f&&(this._views.splice(f,0,c),g=!0)}g||this._views.push(c);this._view.needsReflow()}};this.insertAfter=function(a,b){if(-1==this.getViewIndex(a)){var c=this._initLayoutView(a),g=!1;if(b){var f=this.getViewIndex(b);-1!=f&&(this._views.splice(f+1,0,c),g=!0)}g||this._views.unshift(c);this._view.needsReflow()}};this.reflow=function(){s(this,"reflow",arguments);for(var a=0,b=0,c;c=this._views[b];++b)c.view.style.visible&&(c.index=c.view.style.__sortKey,
++a);if(a){this._views.sort();if(DEBUG)var g=this._view.uid;var f=this._view.style;f.direction!=this._direction&&this.setDirection(f.direction);var k=this._view.getPosition().scale,l="vertical"==this._direction,j=this._propDim,m=this._minPropDim,q=this._propSideA,o=this._propSideB,e=f.padding,h=e&&(l?e.getVertical():e.getHorizontal())||0,r=f[j],p=this._views;this._debug&&logger.log("reflow() view",g+":",p.length,"subview(s)");var i=0,n=0;e&&(l?e.getHorizontal():e.getVertical());for(b=0;c=p[b];++b){var d=
c.view.style;d.visible&&(c.margins=(d[q]||0)+(d[o]||0),d.flex?(n+=d.flex,c.baseSize=d[m]||0,i+=c.baseSize):i+=(d[j]||0)*d.scale+c.margins,e&&(d.x=e.left,d.y=e.top),BoxLayout.reflowX(c.view,f.width,e),BoxLayout.reflowY(c.view,f.height,e))}if(!(n&&void 0==r)&&(b=r-h,!(0>b))){o=f.justifyContent;m=(n||"start"!=o?b:i)+h;i=b-i;if(!n&&"wrapContent"==f[l?"layoutHeight":"layoutWidth"])this._debug&&logger.log("  view",g,"(sizing to fit)",j,"=",m+"px","("+h+"px padding)"),f[j]=m;for(b=h=f=0;c=p[b];++b)d=c.view.style,
d.visible&&d.flex&&(h=c.baseSize+i*(d.flex/n)/d.scale+h,l=Math.round(h/k)*k,h-=l,c.dim=l-c.margins,c.dim>d[this._maxPropDim]&&(c.dim=d[this._maxPropDim]),f+=l);b=i-f;e=e&&e[q]||0;k=0;if(0<b)switch(o){case "end":e+=b;break;case "center":e+=b/2;break;case "space":k=b/(a-1)||0;break;case "space-outside":k=b/(a+1)||0,e+=k}a=this._propPos;for(b=0;c=p[b];++b)d=c.view.style,d.visible&&(d[a]=e+(d[q]||0),this._debug&&logger.log("  view",g,"layout subview",c.view.uid,a,"=",d[a]),d.flex&&(d[j]=c.dim,this._debug&&
logger.log("  view",g,"layout subview",c.view.uid,j,"=",d[j])),e+=k+(d[j]||0)*d.scale+c.margins);this._size!=m&&(this._size=m,this._view.publish("LayoutResize",m))}}}});
