ba66196da02d203190fca13234f563fe
jsio("import device");jsio("from util.browser import $");jsio("import event.input.dispatch as input");var eventTypes=input.eventTypes,UID=-1,sdk_timestep_platforms_browser_Input=__class__;
exports=sdk_timestep_platforms_browser_Input(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(b){if(device.simulatingMobileNative||device.simulatingMobileBrowser)this._simulateMobile=!0;this._evtQueue=[];b.el&&(device.isMobileBrowser&&(this._toggleNode=$({parent:document.body})),this.setElement(b.el));this._isOver=!1;this._keyListener=b.keyListener;if(device.useDOM)$.onEvent(document,device.events.start,this,"handleMouse",eventTypes.START);this.enable();
this._hasFocus=!1;document.addEventListener&&(document.addEventListener("focus",bind(this,"onFocusCapture"),!0),document.addEventListener("blur",bind(this,"onBlurCapture"),!0))};this.enable=function(){this._handleMove=$.onEvent(document,device.events.move,this,"handleMouse",eventTypes.MOVE);this._handleSelect=$.onEvent(document,device.events.end,this,"handleMouse",eventTypes.SELECT);this._handleScroll=$.onEvent(window,"DOMMouseScroll",this,"handleMouse",eventTypes.SCROLL);this._handleWheel=$.onEvent(window,
"mousewheel",this,"handleMouse",eventTypes.SCROLL)};this.disable=function(){this._handleMove&&(this._handleMove(),this._handleMove=!1);this._handleSelect&&(this._handleSelect(),this._handleSelect=!1);this._handleScroll&&(this._handleScroll(),this._handleScroll=!1);this._handleWheel&&(this._handleWheel(),this._handleWheel=!1)};this.onFocusCapture=function(b){var a=b.target.tagName;if("TEXTAREA"==a||"INPUT"==a)this._hasFocus=b.target,this._keyListener&&this._keyListener.setEnabled(!1)};this.onBlurCapture=
function(){this._hasFocus&&(this._hasFocus=null,this._keyListener&&this._keyListener.setEnabled(!0))};this.setElement=function(b){this._el=b;if(this._elEvents)for(var a=0,d;d=this._elEvents[a];++a)d();b.ondragstart=function(){return!1};b.onselectstart=function(){return!1};this._elEvents=[];device.useDOM||this._elEvents.push($.onEvent(b,device.events.start,this,"handleMouse",eventTypes.START));!device.isMobileBrowser&&!device.isNative&&(this._elEvents.push($.onEvent(b,"mouseover",this,"onMouseOver")),
this._elEvents.push($.onEvent(b,"mouseout",this,"onMouseOut")))};this.onMouseOver=function(){this._isOver=!0};this.onMouseOut=function(){this._isOver=!1};this.onMouseDown=function(){this._isMouseDown=!0};this.onMouseUp=function(){this._isMouseUp=!0};this.getEvents=function(){return this._evtQueue.splice(0,this._evtQueue.length)};this.allowScrollEvents=function(b){this._allowScrollEvents=b};this.handleMouse=function(b,a){var d=a.target;if(!(this._hasFocus&&this._hasFocus==d||d&&d.getAttribute&&d.getAttribute("noCapture"))){var e=
device.isMobileBrowser;if(device.useDOM||e||this._isDown||!(this._el&&a.target!=this._el)){if(e)$.stopEvent(a),a.returnValue=!1;else if(this._isOver&&(!this._allowScrollEvents||b!=eventTypes.SCROLL))a.stopPropagation&&a.stopPropagation(),b!=eventTypes.START&&($.stopEvent(a),a.returnValue=!1);if(a.touches)for(var d=0,c;c=a.changedTouches[d];++d)this.handleMouse(b,c,!0);else{var f;if("offsetX"in a&&!device.useDOM)c=a.offsetX,f=a.offsetY;else if(this._el.getBoundingClientRect)f=this._el.getBoundingClientRect(),
c=a.pageX-f.left,f=a.pageY-f.top;else{for(e=this._el;e;)c+=e.offsetTop,f+=e.offsetLeft,e=e.parentNode;c=a.pageX-c;f=a.pageY-f}e=a.identifier||UID;if(this._simulateMobile)switch(b){case eventTypes.START:this._moveOK=!0;break;case eventTypes.MOVE:if(!this._moveOK)return;break;case eventTypes.SELECT:this._moveOK=!1}b==eventTypes.START?this._isDown=!0:b==eventTypes.SELECT&&(this._isDown=!1,this._toggleNode&&(document.body.removeChild(this._toggleNode),document.body.appendChild(this._toggleNode)));c=new input.InputEvent(e,
b,c,f);if(device.useDOM){for(;d&&!d._view;)d=d.parentNode;if(!d)return;c.target=d._view}b==eventTypes.SCROLL&&("wheelDeltaX"in a?(c.scrollDelta=a.wheelDeltaY/120,c.scrollAxis=input.VERTICAL_AXIS,a.wheelDeltaX&&a.wheelDeltaY?(d=c.clone(),d.scrollDelta=a.wheelDeltaX/120,d.scrollAxis=input.HORIZONTAL_AXIS,this._evtQueue.push(d)):a.wheelDeltaX&&(c.scrollDelta=a.wheelDeltaX/120,c.scrollAxis=input.HORIZONTAL_AXIS)):a.detail?(c.scrollDelta=-a.detail,c.scrollAxis="axis"in a?a.axis==a.VERTICAL_AXIS?input.VERTICAL_AXIS:
input.HORIZONTAL_AXIS:input.VERTICAL_AXIS):a.wheelDelta&&(c.scrollDelta=(window.opera?1:-1)*a.wheelDelta/120,c.scrollAxis=input.VERTICAL_AXIS));this._evtQueue.push(c)}}}}});
