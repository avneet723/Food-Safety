61e52df22c0d37a1104caedfe5c0af4f
jsio("import net.interfaces");jsio("from net.protocols.delimited import DelimitedProtocol");exports.RTJPProtocol=__class__;
exports.RTJPProtocol=exports.RTJPProtocol(function(){return this.init&&this.init.apply(this,arguments)},DelimitedProtocol,function(c){this.init=function(){c(this,"init",["\r\n"]);this.frameId=0};this.connectionMade=function(){this._client&&this._client.connectionMade&&this._client.connectionMade();logger.debug("connectionMade")};this.frameReceived=function(){};this.sendFrame=function(b,a){a||(a={});logger.debug("sendFrame",b,JSON.stringify(a));this.sendLine(JSON.stringify([++this.frameId,b,a]));return this.frameId};
this.lineReceived=function(b){try{var a=JSON.parse(b);if(3!=a.length){logger.error("Invalid frame length");return}if("number"!=typeof a[0]){logger.error("Invalid frame id");return}if("string"!=typeof a[1]){logger.error("Invalid frame name");return}logger.debug("frameReceived:",a[0],a[1],JSON.stringify(a[2]))}catch(c){logger.error(c)}a&&this.frameReceived(a[0],a[1],a[2])};this.connectionLost=function(){logger.debug("conn lost")}});
