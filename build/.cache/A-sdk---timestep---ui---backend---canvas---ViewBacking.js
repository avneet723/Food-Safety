96c4d0763f43542e8b3284bce692518e
jsio("import ..strPad");jsio("import ..BaseBacking");jsio("import util.setProperty as setProperty");
var _styleKeys={},sdk_timestep_ui_backend_canvas_ViewBacking=__class__,ViewBacking=exports=sdk_timestep_ui_backend_canvas_ViewBacking(function(){return this.init&&this.init.apply(this,arguments)},BaseBacking,function(){this.init=function(a){this._view=a;this._subviews=[]};this.getSuperview=function(){return this._superview};this.getSubviews=function(){this._needsSort&&(this._needsSort=!1,this._subviews.sort());for(var a=[],b=this._subviews,c=b.length,d=0;d<c;++d)a[d]=b[d]._view;return a};var e=9E5;
this.addSubview=function(a){var b=a.__view,c=b._superview;if(c==this._view)return!1;c&&c.__view.removeSubview(a);a=this._subviews.length;this._subviews[a]=b;b._superview=this._view;b._setAddedAt(++e);a&&b.__sortKey<this._subviews[a-1].__sortKey&&(this._needsSort=!0);return!0};this.removeSubview=function(a){var b=this._subviews.indexOf(a.__view);return-1!=b?(this._subviews.splice(b,1),a.__view._superview=null,!0):!1};this.wrapTick=function(a,b){this._view.tick&&this._view.tick(a,b);for(var c=0,d;d=
this._subviews[c];++c)d.wrapTick(a,b)};this.wrapRender=function(a,b){if(this.visible){this.__firstRender||this._view.needsReflow(!0);this._needsSort&&(this._needsSort=!1,this._subviews.sort());var c=this._width,d=this._height;if(!(0>c||0>d)){a.save();a.translate(this.x+this.anchorX+this.offsetX,this.y+this.anchorY+this.offsetY);this.r&&a.rotate(this.r);1!=this.scale&&a.scale(this.scale,this.scale);1!=this.opacity&&(a.globalAlpha*=this.opacity);a.translate(-this.anchorX,-this.anchorY);this.circle&&
a.translate(-c/2,-d/2);this.clip&&a.clipRect(0,0,c,d);var f=this._view.getFilters();a.setFilters(f);if(this.flipX||this.flipY)a.translate(this.flipX?c/2:0,this.flipY?d/2:0),a.scale(this.flipX?-1:1,this.flipY?-1:1),a.translate(this.flipX?-c/2:0,this.flipY?-d/2:0);try{this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(0,0,c,d));var e=b.viewport;this._view.render&&this._view.render(a,b);this._renderSubviews(a,b);b.viewport=e}finally{a.clearFilters(),a.restore()}}}};this._renderSubviews=
function(a,b){for(var c=0,d,e=this._subviews;d=e[c++];)d.wrapRender(a,b)};this._onResize=function(){this._view.needsReflow()};this._sortIndex=strPad.initialValue;this._onZIndex=function(a,b){this._sortIndex=strPad.pad(b);this._setSortKey();this._view.needsRepaint();var c=this._view.getSuperview();c&&(c.__view._needsSort=!0)};this._setAddedAt=function(a){this._addedAt=a;this._setSortKey()};this._setSortKey=function(){this.__sortKey=this._sortIndex+this._addedAt};this._onOffsetX=function(a){this.offsetX=
a*this.width/100};this._onOffsetY=function(a){this.offsetY=a*this.height/100};this.toString=function(){return this.__sortKey}});
