24a9ef304049bbc2aa6f15b4033a82b1
jsio("import net");jsio("import lib.Enum as Enum");var ctx=jsio.__env.global;exports.Protocol=__class__;
exports.Protocol=exports.Protocol(function(){return this.init&&this.init.apply(this,arguments)},function(){this.connectionMade=function(){};this.dataReceived=function(){};this.connectionLost=function(){};this._connectionMade=function(){this._isConnected=!0;this.connectionMade.apply(this,arguments)};this._connectionLost=function(){this._isConnected=!0;this.connectionLost.apply(this,arguments)};this._isConnected=!1;this.isConnected=function(){return!!this._isConnected}});exports.Client=__class__;
exports.Client=exports.Client(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(a){this._protocol=a};this.connect=function(a,b){this._remote=new this._protocol;this._remote._client=this;net.connect(this._remote,a,b)}});exports.Server=__class__;
exports.Server=exports.Server(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(a){this._protocolClass=a};this.buildProtocol=function(){return new this._protocolClass};this.listen=function(a,b){return net.listen(this,a,b)}});exports.Transport=__class__;
exports.Transport=exports.Transport(function(){return this.init&&this.init.apply(this,arguments)},function(){this._encoding="plain";this.write=function(){throw Error("Not implemented");};this.getPeer=function(){throw Error("Not implemented");};this.setEncoding=function(a){this._encoding=a};this.getEncoding=function(){return this._encoding}});exports.Listener=__class__;
exports.Listener=exports.Listener(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(a,b){this._server=a;this._opts=b||{}};this.onConnect=function(a){var b=this._server.buildProtocol();b.transport=a;b.server=this._server;a.protocol=b;a.makeConnection(b);b._connectionMade()};this.listen=function(){throw Error("Abstract class");};this.stop=function(){}});exports.STATE=Enum("INITIAL","DISCONNECTED","CONNECTING","CONNECTED");exports.Connector=__class__;
exports.Connector=exports.Connector(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(a,b){this._protocol=a;this._opts=b;this._state=exports.STATE.INITIAL};this.getState=function(){return this._state};this.onConnect=function(a){this._state=exports.STATE.CONNECTED;a.makeConnection(this._protocol);this._protocol.transport=a;try{this._protocol._connectionMade()}catch(b){throw logger.error(b);}};this.onDisconnect=function(a){var b=this._state==exports.STATE.CONNECTED;
this._state=exports.STATE.DISCONNECTED;try{this._protocol._connectionLost(a,b)}catch(c){throw logger.error(c);}};this.getProtocol=function(){return this._protocol}});
